<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-slider/paper-slider.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-toggle-button/paper-toggle-button.html">





<!--
Element used to set all the different types of tproperty of the asq-questions.
Example:
    <qea-property-editor
      name='h1Color'
      label='title color'
      type='string',
      widgetType='colour'
      description='property use to set th ecolor of the title'
      default='#eee'
      value={{title.colour}}
      isAdvancedProperty='false'
      isAdvancedUser=[[user.level]]
    ></qea-property-editor>

@demo demo/index.html
-->
<dom-module id="qea-property-editor">
  <template>
    <style>
      :host {
        display: block;
      }
      .propContainer{
        color: rgba(0, 0, 0, 0.7);
        margin: 3px 0;
      }
      .label{

      }
      .setter{
        padding-left: 15px;
        max-width: 70%;
      }
      .infoIcon{
        padding: 5px;
        border-radius: 50%;
        font-size: 1.5em;
        cursor: pointer;
      }
      .infoIcon:hover{
        /*color: red;*/
        background: #eee;
      }
    </style>
    <template is="dom-if" if="[[_isPropertyVisible]]">
      <div class="propContainer">

        <div class="label">
          <span>[[_nameToVisualize]]</span>
          <span class="infoIcon" hidden$="{{!description}}" on-tap='_showInfo'>&#8505</span>
        </div>

        <!-- string -->
        <template is="dom-if" if="[[_showString(type)]]">
          <div class="setter">
            <paper-input label="Input label"
              no-label-float
              value={{value}}>
            </paper-input>
          </div>
        </template>

        <!-- number -->
        <template is="dom-if" if="[[_showNumber(type, 'simple')]]">
          <div class="setter">
            <paper-input label="Input label"
              no-label-float
              type='number'
              value={{value}}>
            </paper-input>
          </div>
        </template>
        <template is="dom-if" if="[[_showNumber(type, 'range')]]">
          <div class="setter">
            <paper-slider editable expand
              min=[[_slider.min]]
              max=[[_slider.max]]
              value={{value}}>
            </paper-slider>
          </div>
        </template>

        <!-- enum -->
        <template is="dom-if" if="[[_showEnum(type)]]">
          <div class="setter">
            <paper-dropdown-menu  selected-Item-Label={{value}} toggles>
              <paper-listbox class="dropdown-content">
                <template is="dom-repeat" items="[[_enum]]">
                  <paper-item>[[item]]</paper-item>
                </template>
              </paper-listbox>
            </paper-dropdown-menu>
          </div>
        </template>

        <!-- boolean -->
        <template is="dom-if" if="[[_showBoolean(type)]]">
          <div class="setter">
            <paper-toggle-button
              checked={{value}}>
            </paper-toggle-button>
          </div>
        </template>

    </template>

  </template>
  <script>
  (function () {
    'use strict'

    class qeaPropertyEditor {

      get behaviors() {
        return [];
      }

      beforeRegister(){
        this.is = 'qea-property-editor'
        this.properties = {
          /**
          * Name of the property
          */
          name: String,

          /**
          * OPTIONAL. User friendly name of the property.
          * if not specified will be used the 'name' property OPTIONAL
          */
          label: {
            type: String,
            value: ''
          },

          /**
          * Specify the type of the input to show to edit the property
          * @value boolean | string | number | enum
          */
          type: {
            type: String,
            value: 'string'
          },

          /**
          * OPTIONAL Specify the type of the advanced input to show
          * to edit the property
          * @value colour | richText  | range | code
          */
          widgetType: String,

          /**
          * OPTIONAL description of the property.
          */
          description: String,

          /**
          * OPTIONAL id of the item you want to apply this property.
          * Use polymer data binding when possible.
          */
          referenceId: String,

          /**
          * OPTIONAL default property value,
          * if type == enum will bea series of strings ex "dog, cat, elephant".
          * if type == number && widgetType == range use this notation "1-10"
          */
          default: {
            notify: true,
            observer: '_setInitialValue'
          },

          value: {
            notify: true,
            observer: '_applyProperty'
          },

          /**
          * OPTIONAL. if true this property will be visible only to advanced users
          * @default true
          */
          isAdvancedProperty: {
            type: String,
            value: 'false'
          },

          /**
          * OPTIONAL. if true all properties will be visible
          * @default true
          */
          isAdvancedUser: {
            type: String,
            value: 'false'
          },

          _nameToVisualize:{
            type: String,
            computed: '_nameChooser(name)'
          },

          _slider:{
            type: Object,
            value: ()=>{return{min:0, max:10}}
          },

          _enum:{
            type: Array,
            value: ()=>[]
          },

          _isPropertyVisible:{
            type: Boolean,
            computed: '_isAcceptableType(type, isAdvancedUser)'
          }
        }
      }

      _isAcceptableType(type, isAdvancedUser){
        let availableType = ['boolean','string','number','enum'].indexOf(type.toLowerCase()) > -1;
        let isAdvUs = (isAdvancedUser.toLowerCase() == 'true');
        let isAdvPr = (this.isAdvancedProperty && this.isAdvancedProperty.toLowerCase() == 'true');

        return availableType && ((isAdvUs === isAdvPr )|| !isAdvPr);
      }

      _showNumber(type, inputKind='simple'){
        if (type === 'number' && this.widgetType == inputKind) {
          return true;
        }else if (type === 'number' && !this.widgetType && inputKind == 'simple') {
          return true;
        }
        return false;
      }

      _showString(type){
        return type.toLowerCase() === 'string';
      }

      _showEnum(type){
        return type.toLowerCase() === 'enum';
      }

      _showBoolean(type){
        return type.toLowerCase() === 'boolean';
      }

      _nameChooser(name){
        let label = this.label || ''
        return label === '' ? name : label;
      }

      _setInitialValue(defaultValue){
        // boolean | string | number | enum
        // colour | richText  | range | code
        switch (this.type.toLowerCase()) {
          case 'boolean':
            this.value = defaultValue == 'true';
            break;
          case 'string':
            if (this.widgetType &&
              ['colour','richText','code'].indexOf(this.widgetType.toLowerCase()) > -1) {
              // set advance editor
            }else {
              this.value = defaultValue;
            }
            break;
          case 'number':
            if (this.widgetType && this.widgetType.toLowerCase() === 'range') {
              let values = defaultValue.split('-')
              this._slider = {min: Number(values[0]), max: Number(values[1])}
            }else {
              this.value = defaultValue;
            }
            break;
          case 'enum':
            this._enum = defaultValue.split(',');
            break;
          default:

        }
      }

      _applyProperty(value){
        if (this.referenceId && this.referenceId !== '') {
          Polymer.dom(this.parentNode).querySelector(`#${this.referenceId}`)[this.name]=value;
        }
      }

      _showInfo() {
       alert(this.description)
     }

    }

    Polymer(qeaPropertyEditor);
  })()
  </script>
</dom-module>
